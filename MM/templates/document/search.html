{% extends 'template.html' %}
{% load static %}

{% block extra_css %}
    <style>
    th{text-align: center}
    td{text-align: center}
    </style>
{% endblock %}

{% block main_content %}
    <section id="main-content">
        <section class="wrapper">
            <h3><i class="fa fa-angle-right"></i> 查看文档流
            </h3>
            <!--h3 id="item_result">&nbsp;1111</h3-->
            <div class="row mt">
                <div class="col-lg-12">
                    <div class="form-panel3">

                        <form id='material1' class="form-horizontal style-form" method="get">
                            <div class="col-sm-3">
                                <input class="form-control" type="text" placeholder="请输入供应商编号" id="sjcode">
                            </div>
                            <label class="col-sm-2 col-sm-2 control-label">
                                <div class="pull-right">时间</div>
                            </label>
                            <div class="col-sm-3">

                                <select id="materialInput2" class="form-control">
                                    <option value='0'>全部</option>
                                    <option value='2'>近三月</option>
                                    <option value='1'>近半年</option>
                                </select>

                            </div>

                            <button type="submit" formmethod="post" class="btn btn-success "><i
                                    class="fa fa-search"></i>
                            </button>
                        </form>

                        <div id='details'>
                            <div class="row mt">
                                <div class="col-md-12">
                                    <div class="col-md-12">
                                        <div class="content-panel">
                                                <table class="table table-striped table-advance table-hover">

                                                    <thead>
                                                        <tr>
                                                            <th>文档类型</th>
                                                            <th>文档编号</th>
                                                            <th>供应商</th>
                                                            <th>日期</th>
                                                            <th>操作</th>
                                                        </tr>
                                                    </thead>

                                                <tbody>
                                                    {% for order in orders %}
                                                    <tr>
                                                        <td>采购订单</td>
                                                        <td>{{ order.id }}</td>
                                                        <td>{{ order.vendor.vname }}</td>
                                                        <td>{{ order.time }}</td>
                                                        <td><a href="#">查看详情</a></td>
                                                    </tr>
                                                    {% endfor %}
                                                    {% for invoice in invoices %}
                                                    <tr>
                                                        <td>发票</td>
                                                        <td>{{ invoice.id }}</td>
                                                        <td>{{ invoice.orderItem.po.vendor.vname }}</td>
                                                        <td>{{ invoice.invoiceDate }}</td>
                                                        <td><a href="#">查看详情</a></td>
                                                    </tr>
                                                    {% endfor %}
                                                    {% for receipt in receipts %}
                                                    <tr>
                                                        <td>收据</td>
                                                        <td>{{ receipt.id }}</td>
                                                        <td>{{ receipt.orderItem.po.vendor.vname }}</td>
                                                        <td>{{ receipt.time }}</td>
                                                        <td><a href="#">查看详情</a></td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>

                                            </table>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </section>
{% endblock %}

{% block js %}

    <script>
        //文档流搜索
$('#material1').on('submit', function (e) {
    e.preventDefault();

    $.ajax({
        type: "POST",
        url: "{% url 'MM:search_document_flow' %}",  // 修正URL
        data: {
            dataType: "json",
            csrfmiddlewaretoken: '{{ csrf_token }}',
            vendor_code: $("#sjcode").val(),  // 获取供应商编号
            time_range: $("#materialInput2").val()  // 获取时间范围
        },
        success: function (data) {
            var out = '';
            data.orders.forEach(function(order) {
                out += '<tr><td>采购订单</td><td>' + order.id + '</td><td>' + order.vendor__vname + '</td><td>' + order.time + '</td><td><a href="#">查看详情</a></td></tr>';
            });
            data.invoices.forEach(function(invoice) {
                out += '<tr><td>发票</td><td>' + invoice.id + '</td><td>' + invoice.orderItem__po__vendor__vname + '</td><td>' + invoice.invoiceDate + '</td><td><a href="#">查看详情</a></td></tr>';
            });
            data.receipts.forEach(function(receipt) {
                out += '<tr><td>收据</td><td>' + receipt.id + '</td><td>' + receipt.orderItem__po__vendor__vname + '</td><td>' + receipt.time + '</td><td><a href="#">查看详情</a></td></tr>';
            });

            // 更新页面上的表格
            $('table tbody').html(out);
        },
        failure: function () {
            showMessage({ text: '搜索失败，请重试。', type: 'error' });
        }
    });
});

    </script>

    <script>
        (function () {
            const input = document.getElementById('my-input');
            const datepicker = new TheDatepicker.Datepicker(input);
            datepicker.render();
        })();
    </script>


{% endblock %}
